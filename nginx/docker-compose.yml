version: "3"

services:
  certbot:
    image: certbot/dns-cloudflare:v1.30.0
    command: renew
    volumes:
      - /home/earlopain/letsencrypt:/etc/letsencrypt
      - ${SERVER_PROJECT_DIR}/nginx/certbot_secrets.ini:/etc/letsencrypt/secrets.ini
    profiles:
      - certbot

  nginx:
    image: nginx:1.23-alpine
    container_name: server_nginx
    ports:
      - 443:443
    volumes:
      - /home/earlopain/letsencrypt:/etc/letsencrypt
      - ${SERVER_PROJECT_DIR}/nginx/nginx.conf:/etc/nginx/conf.d/nginx.conf
